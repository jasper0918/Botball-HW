(function(c,d){typeof define==="function"&&define.amd?define(["CKEDITOR","face","htmlEncode"],d):c.wordcount=d(c.CKEDITOR)})(this,function(c,d,f){c.plugins.add("wordcount",{version:0.1,_editor:null,_wordLimit:140,init:function(a){function b(a){var b=e.getText(),b=parseInt(e.getTextLength(b)),c="",c=b===0?d.replace("{currentCountLabel}","\u8fd8\u80fd\u8f93\u5165").replace("{class}","cke-normal-count").replace("{currentCount}",e._wordLimit):b<=e._wordLimit?d.replace("{currentCountLabel}","\u8fd8\u80fd\u8f93\u5165").replace("{class}",
"cke-normal-count").replace("{currentCount}",parseInt(e._wordLimit)-b):d.replace("{currentCountLabel}","\u5df2\u7ecf\u8d85\u8fc7").replace("{class}","cke-overflow-count").replace("{currentCount}",b-parseInt(e._wordLimit));document.getElementById("cke_wordcount_"+a.name).innerHTML=c;return false}this._editor=a;if(a.elementMode!==c.ELEMENT_MODE_INLINE){var e=this;a.config.wordcount&&(this._wordLimit=a.config.wordcount.wordLimit);var d='<span class="cke_path_item cke_current_count_cb">{currentCountLabel}<span  id="current-count" class="{class}">{currentCount}</span>\u5b57</span>';
a.on("uiSpace",function(a){a.data.space=="bottom"&&(a.data.html+='<div id="cke_wordcount_'+a.editor.name+'" class="cke_wordcount" style=""  >&nbsp;</div>')},a,null,100);a.on("dataReady",function(a){b(a.editor)},a,null,100);a.on("afterPaste",function(c){b(c.editor);a.fire("change")},a,null,100);a.on("key",function(a){setTimeout(function(){b(a.editor)},50)},a,null,100);a.on("faceInsert",function(c){b(c.editor);a.fire("change")},a,null,100)}},strip:function(a){return f.normalText(a)},getTextLength:function(a){var b=
a||this.getText();return b?(b=b.replace(/\[\/([\u4e00-\u9fa5OKN]{1,3})\]/g,"\u5403"),a=b.match(/[^\x00-\xff]/g)||[],b=b.replace(/[^\x00-\xff]/g,""),a.length+b.length/3+0.9):0},getText:function(){var a=this.getRichText(),b="";a&&(b=this.strip(d.imgs2Code(a).replace(/(\r\n|\n|\r)/gm," ")));return b},getRichText:function(){return this._editor.getData()},isOutLength:function(){return this.getTextLength()>this._wordLimit}})});
