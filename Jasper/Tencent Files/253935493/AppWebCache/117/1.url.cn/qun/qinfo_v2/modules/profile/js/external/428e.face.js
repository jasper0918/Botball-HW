(function(d,l){typeof define==="function"&&define.amd?define(["simple"],l):d.face=l(d.$)})(this,function(d){var l=function(){var x;function y(a){e=d.dom.getNode("div",{"class":(a.cls?a.cls+" ":"")+"face_selector"});window.setTimeout(function(){e.innerHTML='<div class="face_hover"></div><div class="inner_pnl"></div><div class="row"></div><div class="bg"></div>';g=d.dom.queryClass("face_hover","div",e);h=d.dom.queryClass("inner_pnl","div",e);for(var f=[],b=0;b<105;)f.push('<a href="javascript:void(0)" i='+
b+' hidefocus="true"></a>'),b++;h.innerHTML=f.join("");d.e.add(h,"click",G);d.e.add(h,"mousedown",H);d.e.add(h,"mouseenter",I);d.e.add(h,"mouseleave",J);d.e.add(h,"mouseover",K);d.e.add(document,"mouseup",p);d.e.add(document,"click",q);d.oop.addObserver(l,"saveFace",L);i=d.dom.queryClass("row","div",e);z=true;A(a)},0)}function K(a){a=a.target;if(a.tagName=="A"&&(a=a.getAttribute("i"))){var f=n[a];if(f){var b=Math.floor(a/B),b=a%B<2&&b<2;if(!(b&&g._right||!b&&!g._right&&typeof g._right!="undefined")){var c=
{};c[b?"right":"left"]="7px";c[b?"left":"right"]="";d.css.setStyle(g,c);g._right=b}g.innerHTML='<div class="img"><img class="face" title="'+f+'" src="http://0.web.qstatic.com/webqqpic/style/face/'+a+'.gif" alt="[/'+f+']" rel="face"></div><div class="name">'+f+"</div>"}}}function I(){d.css.show(g)}function J(){d.css.hide(g)}function p(){document.body.releaseCapture&&document.body.releaseCapture();d.e.remove(document,"mouseup",p)}function H(a){document.body.setCapture&&document.body.setCapture();a.preventDefault();
a.stopPropagation();d.e.add(document,"mouseup",p)}function G(a){a.stopPropagation();if(a=a.target.getAttribute("i")){a="[/"+n[a]+"]";if(r)try{var f=r,b="",c=0,d=0;f.focus();if(f.setSelectionRange)c=f.selectionStart,d=f.selectionEnd,c!=d&&f.value.substring(c,d);else if(document.selection){var e,g=document.selection.createRange(),h=document.body.createTextRange();h.moveToElementText(f);b=g.text;g.getBookmark();for(e=0;h.compareEndPoints("StartToStart",g)<0&&g.moveStart("character",-1)!==0;e++)f.value.charAt(e)==
"\n"&&e++;c=e;d=b.length+c}e=d;var j=f.value,g=[],i;g[0]=j.substring(0,c);g[1]=a;g[2]=j.substr(e);i=g.join("");f.value=i}catch(k){}else j=document.createElement("div"),j.innerHTML=s(a),j=j.removeChild(j.getElementsByTagName("img")[0]),t&&t({text:a,dom:j});q()}}function L(){document.body.appendChild(e)}function A(a){r=a.input||null;C=a.parent||document.body;t=a.onSelect||null;u=a.onHide||null;e.style.left=a.x+"px";e.style.top=a.y+"px";if(typeof a.rowX!=="undefined")i.style.left=a.rowX+"px";C.appendChild(e);
d.css.show(e);e.style.visibility="hidden";var f=null;if(f=a.arrowTarget){var a=f.getBoundingClientRect(),b=e.getBoundingClientRect();b.top>=a.top?d.css.removeClass(i,"bottom_row"):d.css.addClass(i,"bottom_row");i.style.left=a.left-b.left-parseInt(x/2)+parseInt(d.css.getClientWidth(f)/2)+"px";d.css.show(i)}else d.css.hide(i);e.style.visibility="visible";v=true}function q(){d.css.hide(e);v=false;u&&u()}var n="\u5fae\u7b11,\u6487\u5634,\u8272,\u53d1\u5446,\u5f97\u610f,\u6d41\u6cea,\u5bb3\u7f9e,\u95ed\u5634,\u7761,\u5927\u54ed,\u5c34\u5c2c,\u53d1\u6012,\u8c03\u76ae,\u5472\u7259,\u60ca\u8bb6,\u96be\u8fc7,\u9177,\u51b7\u6c57,\u6293\u72c2,\u5410,\u5077\u7b11,\u53ef\u7231,\u767d\u773c,\u50b2\u6162,\u9965\u997f,\u56f0,\u60ca\u6050,\u6d41\u6c57,\u61a8\u7b11,\u5927\u5175,\u594b\u6597,\u5492\u9a82,\u7591\u95ee,\u5618,\u6655,\u6298\u78e8,\u8870,\u9ab7\u9ac5,\u6572\u6253,\u518d\u89c1,\u64e6\u6c57,\u62a0\u9f3b,\u9f13\u638c,\u7cd7\u5927\u4e86,\u574f\u7b11,\u5de6\u54fc\u54fc,\u53f3\u54fc\u54fc,\u54c8\u6b20,\u9119\u89c6,\u59d4\u5c48,\u5feb\u54ed\u4e86,\u9634\u9669,\u4eb2\u4eb2,\u5413,\u53ef\u601c,\u83dc\u5200,\u897f\u74dc,\u5564\u9152,\u7bee\u7403,\u4e52\u4e53,\u5496\u5561,\u996d,\u732a\u5934,\u73ab\u7470,\u51cb\u8c22,\u793a\u7231,\u7231\u5fc3,\u5fc3\u788e,\u86cb\u7cd5,\u95ea\u7535,\u70b8\u5f39,\u5200,\u8db3\u7403,\u74e2\u866b,\u4fbf\u4fbf,\u6708\u4eae,\u592a\u9633,\u793c\u7269,\u62e5\u62b1,\u5f3a,\u5f31,\u63e1\u624b,\u80dc\u5229,\u62b1\u62f3,\u52fe\u5f15,\u62f3\u5934,\u5dee\u52b2,\u7231\u4f60,NO,OK,\u7231\u60c5,\u98de\u543b,\u8df3\u8df3,\u53d1\u6296,\u6004\u706b,\u8f6c\u5708,\u78d5\u5934,\u56de\u5934,\u8df3\u7ef3,\u6325\u624b,\u6fc0\u52a8,\u8857\u821e,\u732e\u543b,\u5de6\u592a\u6781,\u53f3\u592a\u6781".split(","),
D="\u53e3\u7ea2,\u94bb\u6212,\u9774\u5b50,\u706f\u7b3c,\u706f\u6ce1,\u70b9\u6ef4,\u7535\u89c6\u673a,\u7167\u76f8\u673a,\u98ce\u8f66,\u516c\u6587\u5305,\u8d2d\u7269\u888b,\u6d77\u9b42\u886b,\u7ea2\u9886\u5dfe,\u8774\u8776\u7ed3,\u7687\u51a0,\u706b\u8f66\u5934,\u706b\u7bad,\u9152\u676f,\u8721\u70db,\u516b\u722a\u9c7c,\u71d5\u5b50,\u5c0f\u732b,\u732b\u5934\u9e70,\u6bdb\u6bdb\u866b,\u9e8b\u9e7f,\u9e2d\u5b50,\u5c0f\u9e21,\u9752\u86d9,\u4e4c\u9f9f,\u718a\u732b,\u68d5\u718a,\u725b\u5976,\u82f9\u679c,\u6a31\u6843,\u6843\u5b50,\u6a58\u5b50,\u897f\u74dc,\u8349\u8393,\u5de7\u514b\u529b\u51b0\u68d2,\u9e21\u817f,\u592a\u9633,\u5f69\u8679,\u6d6e\u4e91,\u591a\u4e91,\u5c0f\u96e8,\u4e2d\u96e8,\u5927\u96e8,\u96ea\u82b1,\u6708\u5706,\u6c7d\u8f66,\u6728\u9a6c,\u95f9\u949f,\u94c5\u7b14,\u96e8\u4f1e,\u6c99\u53d1,\u624b\u67c4,UFO,\u918b\u575b,\u5b59\u609f\u7a7a,\u5510\u50e7,\u5929\u4f7f,\u6076\u9b54,\u62db\u8d22\u732b,\u5a03\u5a03\u5934,\u536b\u751f\u7eb8,\u4ed9\u4eba\u7403,\u9999\u70df,\u70df\u6597,\u677f\u7816,\u8759\u8760,\u5e7d\u7075,\u5357\u74dc\u706f".split(","),
w={"\u5472\u7259":{text:"\u5472\u7259",code:0},"\u8c03\u76ae":{text:"\u8c03\u76ae",code:1},"\u6d41\u6c57":{text:"\u6d41\u6c57",code:2},"\u5077\u7b11":{text:"\u5077\u7b11",code:3},"\u518d\u89c1":{text:"\u518d\u89c1",code:4},"\u6572\u6253":{text:"\u6572\u6253",code:5},"\u64e6\u6c57":{text:"\u64e6\u6c57",code:6},"\u732a\u5934":{text:"\u732a\u5934",code:7},"\u73ab\u7470":{text:"\u73ab\u7470",code:8},"\u6d41\u6cea":{text:"\u6d41\u6cea",code:9},"\u5927\u54ed":{text:"\u5927\u54ed",code:10},"\u5618":{text:"\u5618",
code:11},"\u9177":{text:"\u9177",code:12},"\u6293\u72c2":{text:"\u6293\u72c2",code:13},"\u59d4\u5c48":{text:"\u59d4\u5c48",code:14},"\u4fbf\u4fbf":{text:"\u4fbf\u4fbf",code:15},"\u70b8\u5f39":{text:"\u70b8\u5f39",code:16},"\u83dc\u5200":{text:"\u83dc\u5200",code:17},"\u53ef\u7231":{text:"\u53ef\u7231",code:18},"\u8272":{text:"\u8272",code:19},"\u5bb3\u7f9e":{text:"\u5bb3\u7f9e",code:20},"\u5f97\u610f":{text:"\u5f97\u610f",code:21},"\u5410":{text:"\u5410",code:22},"\u5fae\u7b11":{text:"\u5fae\u7b11",
code:23},"\u53d1\u6012":{text:"\u53d1\u6012",code:24},"\u5c34\u5c2c":{text:"\u5c34\u5c2c",code:25},"\u60ca\u6050":{text:"\u60ca\u6050",code:26},"\u51b7\u6c57":{text:"\u51b7\u6c57",code:27},"\u7231\u5fc3":{text:"\u7231\u5fc3",code:28},"\u793a\u7231":{text:"\u793a\u7231",code:29},"\u767d\u773c":{text:"\u767d\u773c",code:30},"\u50b2\u6162":{text:"\u50b2\u6162",code:31},"\u96be\u8fc7":{text:"\u96be\u8fc7",code:32},"\u60ca\u8bb6":{text:"\u60ca\u8bb6",code:33},"\u7591\u95ee":{text:"\u7591\u95ee",code:34},
"\u7761":{text:"\u7761",code:35},"\u4eb2\u4eb2":{text:"\u4eb2\u4eb2",code:36},"\u61a8\u7b11":{text:"\u61a8\u7b11",code:37},"\u7231\u60c5":{text:"\u7231\u60c5",code:38},"\u8870":{text:"\u8870",code:39},"\u6487\u5634":{text:"\u6487\u5634",code:40},"\u9634\u9669":{text:"\u9634\u9669",code:41},"\u594b\u6597":{text:"\u594b\u6597",code:42},"\u53d1\u5446":{text:"\u53d1\u5446",code:43},"\u53f3\u54fc\u54fc":{text:"\u53f3\u54fc\u54fc",code:44},"\u62e5\u62b1":{text:"\u62e5\u62b1",code:45},"\u574f\u7b11":{text:"\u574f\u7b11",
code:46},"\u98de\u543b":{text:"\u98de\u543b",code:47},"\u9119\u89c6":{text:"\u9119\u89c6",code:48},"\u6655":{text:"\u6655",code:49},"\u5927\u5175":{text:"\u5927\u5175",code:50},"\u53ef\u601c":{text:"\u53ef\u601c",code:51},"\u5f3a":{text:"\u5f3a",code:52},"\u5f31":{text:"\u5f31",code:53},"\u63e1\u624b":{text:"\u63e1\u624b",code:54},"\u80dc\u5229":{text:"\u80dc\u5229",code:55},"\u62b1\u62f3":{text:"\u62b1\u62f3",code:56},"\u51cb\u8c22":{text:"\u51cb\u8c22",code:57},"\u996d":{text:"\u996d",code:58},
"\u86cb\u7cd5":{text:"\u86cb\u7cd5",code:59},"\u897f\u74dc":{text:"\u897f\u74dc",code:60},"\u5564\u9152":{text:"\u5564\u9152",code:61},"\u74e2\u866b":{text:"\u74e2\u866b",code:62},"\u52fe\u5f15":{text:"\u52fe\u5f15",code:63},OK:{text:"OK",code:64},"\u7231\u4f60":{text:"\u7231\u4f60",code:65},"\u5496\u5561":{text:"\u5496\u5561",code:66},"\u94b1":{text:"\u94b1",code:67},"\u6708\u4eae":{text:"\u6708\u4eae",code:68},"\u7f8e\u5973":{text:"\u7f8e\u5973",code:69},"\u5200":{text:"\u5200",code:70},"\u53d1\u6296":{text:"\u53d1\u6296",
code:71},"\u5dee\u52b2":{text:"\u5dee\u52b2",code:72},"\u62f3\u5934":{text:"\u62f3\u5934",code:73},"\u5fc3\u788e":{text:"\u5fc3\u788e",code:74},"\u592a\u9633":{text:"\u592a\u9633",code:75},"\u793c\u7269":{text:"\u793c\u7269",code:76},"\u8db3\u7403":{text:"\u8db3\u7403",code:77},"\u9ab7\u9ac5":{text:"\u9ab7\u9ac5",code:78},"\u6325\u624b":{text:"\u6325\u624b",code:79},"\u95ea\u7535":{text:"\u95ea\u7535",code:80},"\u9965\u997f":{text:"\u9965\u997f",code:81},"\u56f0":{text:"\u56f0",code:82},"\u5492\u9a82":{text:"\u5492\u9a82",
code:83},"\u6298\u78e8":{text:"\u6298\u78e8",code:84},"\u62a0\u9f3b":{text:"\u62a0\u9f3b",code:85},"\u9f13\u638c":{text:"\u9f13\u638c",code:86},"\u7cd7\u5927\u4e86":{text:"\u7cd7\u5927\u4e86",code:87},"\u5de6\u54fc\u54fc":{text:"\u5de6\u54fc\u54fc",code:88},"\u54c8\u6b20":{text:"\u54c8\u6b20",code:89},"\u5feb\u54ed\u4e86":{text:"\u5feb\u54ed\u4e86",code:90},"\u5413":{text:"\u5413",code:91},"\u7bee\u7403":{text:"\u7bee\u7403",code:92},"\u4e52\u4e53":{text:"\u4e52\u4e53",code:93},NO:{text:"NO",code:94},
"\u8df3\u8df3":{text:"\u8df3\u8df3",code:95},"\u6004\u706b":{text:"\u6004\u706b",code:96},"\u8f6c\u5708":{text:"\u8f6c\u5708",code:97},"\u78d5\u5934":{text:"\u78d5\u5934",code:98},"\u56de\u5934":{text:"\u56de\u5934",code:99},"\u8df3\u7ef3":{text:"\u8df3\u7ef3",code:100},"\u6fc0\u52a8":{text:"\u6fc0\u52a8",code:101},"\u8857\u821e":{text:"\u8857\u821e",code:102},"\u732e\u543b":{text:"\u732e\u543b",code:103},"\u5de6\u592a\u6781":{text:"\u5de6\u592a\u6781",code:104},"\u53f3\u592a\u6781":{text:"\u53f3\u592a\u6781",
code:105},"\u95ed\u5634":{text:"\u95ed\u5634",code:106},"\u62db\u8d22\u8fdb\u5b9d":{text:"\u62db\u8d22\u8fdb\u5b9d",code:107},"\u53cc\u559c":{text:"\u53cc\u559c",code:108},"\u97ad\u70ae":{text:"\u97ad\u70ae",code:109},"\u706f\u7b3c":{text:"\u706f\u7b3c",code:110},"\u53d1\u8d22":{text:"\u53d1\u8d22",code:111},"K\u6b4c":{text:"K\u6b4c",code:112},"\u8d2d\u7269":{text:"\u8d2d\u7269",code:113},"\u90ae\u4ef6":{text:"\u90ae\u4ef6",code:114},"\u5e05":{text:"\u5e05",code:115},"\u559d\u5f69":{text:"\u559d\u5f69",
code:116},"\u7948\u7977":{text:"\u7948\u7977",code:117},"\u7206\u7b4b":{text:"\u7206\u7b4b",code:118},"\u68d2\u68d2\u7cd6":{text:"\u68d2\u68d2\u7cd6",code:119},"\u559d\u5976":{text:"\u559d\u5976",code:120},"\u4e0b\u9762":{text:"\u4e0b\u9762",code:121},"\u9999\u8549":{text:"\u9999\u8549",code:122},"\u98de\u673a":{text:"\u98de\u673a",code:123},"\u5f00\u8f66":{text:"\u5f00\u8f66",code:124},"\u9ad8\u94c1\u5de6\u8f66\u5934":{text:"\u9ad8\u94c1\u5de6\u8f66\u5934",code:125},"\u8f66\u53a2":{text:"\u8f66\u53a2",
code:126},"\u9ad8\u94c1\u53f3\u8f66\u5934":{text:"\u9ad8\u94c1\u53f3\u8f66\u5934",code:127},"\u591a\u4e91":{text:"\u591a\u4e91",code:128},"\u4e0b\u96e8":{text:"\u4e0b\u96e8",code:129},"\u949e\u7968":{text:"\u949e\u7968",code:130},"\u718a\u732b":{text:"\u718a\u732b",code:131},"\u706f\u6ce1":{text:"\u706f\u6ce1",code:132},"\u98ce\u8f66":{text:"\u98ce\u8f66",code:133},"\u95f9\u949f":{text:"\u95f9\u949f",code:134},"\u6253\u4f1e":{text:"\u6253\u4f1e",code:135},"\u5f69\u7403":{text:"\u5f69\u7403",code:136},
"\u94bb\u6212":{text:"\u94bb\u6212",code:137},"\u6c99\u53d1":{text:"\u6c99\u53d1",code:138},"\u7eb8\u5dfe":{text:"\u7eb8\u5dfe",code:139},"\u836f":{text:"\u836f",code:140},"\u624b\u67aa":{text:"\u624b\u67aa",code:141},"\u9752\u86d9":{text:"\u9752\u86d9",code:142}},o=null,m=null,k=null,E=/\[\/([\u4e00-\u9fa5OKN]{1,3})\]/g,M=RegExp("/("+D.join("|")+")","g"),v=false,z=false,r,C,e,h,g,i,t,u=null,B=15;x=13;var s=function(a){return a?a.replace(E,function(a,b){var c=d.array.indexOf(n,b);return c>-1?'<img class="face" title="'+
b+'" src="http://0.web.qstatic.com/webqqpic/style/face/'+c+'.gif" alt="'+("[/"+b+"]")+'" rel="face">':a}):a},F=function(a){return a.replace(/\[\/([\u4e00-\u9fa5OKN]{1,3})\]/gi,function(a,b){var c=w[b];return c?String.fromCharCode(20)+String.fromCharCode(c.code):a})};(function(){o||(o={},d.array.forEach(n,function(a,b){o[a]=b}));m||(m={},d.array.forEach(D,function(a,b){m[a]=b+1}));if(!k){k=[];for(var a in w)k[w[a].code-0]=a}})();return{show:function(a){z?e&&e.innerHTML==""?y(a||{}):A(a):y(a||{})},
hide:q,isShow:function(){return v},code2Img:s,code2LnImg:function(a){return a?a.replace(M,function(a,b){var c=m[b];if(!c&&b.length>2){do b=b.substring(0,b.length-1),c=m[b];while(!c&&b.length>2)}return c?(c="http://imgcache.qq.com/club/item/indivsign/itemlist/$folder$/24_$id$.png".replace("$id$",c).replace("$folder$",c%10),'<img width=20 height=20 class="face ln_face" title="'+b+'" src="'+c+'" alt="'+("[/"+b+"]")+'" rel="face">'):a}):a},img2Code:function(a){return a?"[/"+a.title+"]":""},move:function(a,
f){e.style.left=parseInt(e.style.left)+a+"px";e.style.top=parseInt(e.style.top)+f+"px"},getPanelSize:function(){return{height:205,width:417}},hasFace:function(a){var f=false,b=null,c="";if(b=a.match(E))for(var a=0,d=b.length;a<d;a++)if(c=b[a],c=c.substring(2,c.length-1),typeof o[c]!=="undefined"){f=true;break}return f},isFace:function(a){return a.getAttribute("rel")==="face"},imgs2Code:function(a){return a.replace(/<img.+?\/>/gi,function(a){var b=a.match(/alt="(\[\/[\u4e00-\u9fa5OKN]{1,3}\])"/);return b?
b[1]:a})},faceCode2MoblieCode:F,moblieCode2FaceCode:function(a){return a.replace(/\u0014(.)/gi,function(a,b){var c=k[parseInt(b?b.charCodeAt(0):b)];return c?"[/"+c+"]":a})},moblieCode2Img:function(a){return a.replace(/\u0014(.)/gi,function(a,b){var c=k[parseInt(b?b.charCodeAt(0):b)];return c?s("[/"+c+"]"):a})},imgs2MoblieCode:function(a){return a.replace(/<img.+?\/>/gi,function(a){var b=a.match(/alt="(\[\/[\u4e00-\u9fa5OKN]{1,3}\])"/);return b?F(b[1]):a})},moblieCode2Text:function(a){return a.replace(/\u0014(.)/gi,
function(a,b){var c=k[parseInt(b?b.charCodeAt(0):b)];return c?"/"+c:a})}}}();return l});
