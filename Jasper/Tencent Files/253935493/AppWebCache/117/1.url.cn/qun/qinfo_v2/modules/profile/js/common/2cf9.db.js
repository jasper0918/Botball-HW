(function(c,f){typeof define==="function"&&define.amd?define(["simple","../../../common/js/log","../../../common/js/login","../../../common/js/proj_cfg"],f):c.DB=f(c.$,c.LOG,c.Login,c.proj_cfg)})(this,function(c,f,l,m){c.http.get=function(a,b,e,g){var j=[],d;for(d in b)j.push(d+"="+encodeURIComponent(b[d]));j.length>0&&(a.indexOf("?")==-1&&(a+="?"),a+=j.join("&"));return c.http.ajax(a,null,e,"GET",g)};c.http.post=function(a,b,e,g){var j="",d;for(d in b)j+="&"+d+"="+encodeURIComponent(b[d]).replace(/%C2%A0/gim,
"%20").replace(/%0D%0A/g,"%0A");return c.http.ajax(a,j,e,"POST",g)};var k=m.DBCfg,i={status:{bkn:"",baseKeyHello:true},encryptSkey:function(){var a=c.cookie.get("skey");if(!a)return c.report&&c.report(45),"";for(var b=5381,e=0,g=a.length;e<g;++e)b+=(b<<5)+a.charAt(e).charCodeAt();return b&2147483647},cgiHttp:function(a){if(a&&a.url){var b=this;a.param=a.param||{};var e,g=function(c){var d=(c||{}).ec,h,i;typeof d=="undefined"&&(d=999);switch(d){case 0:h=false;(a.succ||function(){})(c);break;case 1:f({type:"info",
msg:"CGI NoLogin Error! Ec :"+d,url:a.url,mid:k.ec0_mid});b.cgiHttp.basekeytimes>=3?(h=true,f({type:"error",msg:"basekey\u7eed\u671f\u540e, \u4ecd\u7136\u53d1\u73b0\u65e0\u767b\u9646\u6001! ",url:a.url})):a.noNeedLogin?h=true:l?l.notLoginCallback({succ:function(){a.param.bkn=b.status.bkn=b.encryptSkey();e(a.url,a.param,g)},err:function(){f({type:"error",msg:"\u65e0\u767b\u9646\u6001\u540e\u8d70\u767b\u9646\u6d41\u7a0b\u4ecd\u7136\u5931\u8d25\u4e86! ",url:a.url,mid:k.reloginFailed_mid})}}):f({type:"error",
msg:"\u65e0\u767b\u9646\u6001\u540e\u5c1d\u8bd5\u8d70\u91cd\u65b0\u767b\u9646\u6d41\u7a0b,\u4f46\u672a\u627e\u5230Login\u5bf9\u8c61! ",url:a.url});break;case 4:f({type:"info",msg:"CGI BaseKey Error! Ec :"+d,url:a.url,mid:k.ec4_mid});b.cgiHttp.basekeytimes>=3?(h=true,f({type:"error",msg:"basekey\u7eed\u671f\u540e, \u4ecd\u7136\u53d1\u73b0basekey\u9519\u8bef! ",url:a.url})):(b.cgiHttp.basekeytimes=(b.cgiHttp.basekeytimes||0)+1,a.param.bkn=b.status.bkn=b.encryptSkey(),e(a.url,a.param,g));break;case 2:i=
h=true;break;case 3:h=true;break;default:i=h=true}h&&(a.err||function(){})(c);i&&f({type:"info",msg:"CGI Other Error! Ec :"+d,url:a.url,mid:k.ecx_mid})};e=c.http.get;if(!a.type||a.type=="POST"){e=c.http.post;if(!b.status.bkn)b.status.bkn=b.encryptSkey();a.param.bkn=b.status.bkn}a.src="qinfo_v2";b.cgiHttp.basekeytimes=1;return e(a.url,a.param,g)}},api_sample:function(a){var b={};b.param=a.param||{};b.url="/cgi-bin/cgi_sample";b.succ=function(b){(a.succ||function(){})(b)};b.err=function(b){(a.err||
function(){})(b)};this.cgiHttp(b)},genSimpleAPI:function(a,b){i[a]=i[a]||function(a){var c={};c.param=a.param||{};c.url="/cgi-bin/"+b;c.succ=function(b){(a.succ||function(){})(b)};c.err=function(b){(a.err||function(){})(b)};i.cgiHttp(c)}},getDBData:function(){},setDBData:function(){}};return i});
