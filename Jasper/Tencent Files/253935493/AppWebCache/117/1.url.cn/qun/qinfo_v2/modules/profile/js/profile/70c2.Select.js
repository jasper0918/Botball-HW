(function(b,e){typeof define==="function"&&define.amd?define(["simple","../common/util"],e):b.Select=e(b.$,b.Util)})(this,function(b,e){var c=new b.oop.Class({init:function(a){this.dataSource=[];var b=document.createElement("span");b.className="title";b.innerHTML=a||"-";a=document.createElement("div");a.className="select";this.tmpl=e.tmpl('<ul aria-expanded="false" role="list" tabIndex="-1"><% for (var i = 0, len = obj.length; i<len; i++){ %><li role="option" tabIndex="-1"><a href="javascript:void(0)" data="<%=obj[i][0]%>"><%=obj[i][1]%></a></li><% } %></ul>');
this.$title=b;this.$select=a;this.visible=false;this.$select.style.display="none"},render:function(b){this.dataSource=b;this.$select.innerHTML=this.tmpl(b);this.$select.firstChild.id=this.$select.parentNode.id+"-ul"},set:function(a){for(var d=this.dataSource,c=0,f=d.length;c<f;c++)if(d[c][1]===a){b.e.trigger(this.$select.getElementsByTagName("a")[c],"click");break}},afterSelect:function(b){if(!this._callbacks)this._callbacks=[];this._callbacks.push(b)},arm:function(a){var d=b.dom.getNode("div",{"class":"title-wrap",
tabIndex:"1",role:"combobox","aria-autocomplete":"false","aria-readonly":"true","aria-label":"\u8bf7\u6309\u4e0a\u4e0b\u952e\u9009\u62e9,enter\u952e\u786e\u8ba4",readonly:"true"});d.appendChild(this.$title);a.appendChild(d);a.appendChild(this.$select);d.setAttribute("aria-owns",a.id+"-ul");this.keyboardHandler=function(a){var c=this,d=this.$select.firstChild.children,e=function(a){var e=c.keySel===void 0?-1:c.keySel,a=e+a;if(a>=0&&a<d.length)e>=0&&b.css.removeClass(d[e],"on"),b.css.addClass(d[a],
"on"),c.keySel=a,d[a].setAttribute("tabIndex","1"),d[a].focus(),d[e]&&d[e].setAttribute("tabIndex","-1")};switch(a.keyCode){case 38:!c.visible&&c.show();e(-1);break;case 40:!c.visible&&c.show();e(1);break;case 13:this.keySel!==void 0&&(this.onSelectItem({target:d[this.keySel].firstChild}),a.preventDefault())}a.stopPropagation()};b.e.add(d,"click",b.oop.bind(this.onTitleClick,this));b.e.add(this.$select,"click",b.oop.bind(this.onSelectItem,this));b.e.add(this.$select,"scroll",b.oop.bind(this.onSrollInSelect,
this));b.e.add(d,"focus",b.oop.bind(function(){c.hideAll()},this));b.e.add(a,"keyup",b.oop.bind(this.keyboardHandler,this))},mark:function(a){b.css[a?"addClass":"removeClass"](this.$title.parentNode,"error")},onTitleClick:function(a){this.toggle();a.stopPropagation()},onSelectItem:function(a){var a=a.target,c=parseInt(a.getAttribute("data"),10);if(this.id!==c&&(this.$title.innerHTML=a.innerHTML,this.id=c,this.$title.setAttribute("aria-label","\u60a8\u5df2\u9009\u62e9"+this.$title.innerHTML),this._callbacks)){a=
0;for(c=this._callbacks.length;a<c;a++)this._callbacks[a].call(null)}this.keySel!==void 0&&(b.css.removeClass(this.$select.firstChild.children[this.keySel],"on"),this.$select.firstChild.children[this.keySel].setAttribute("tabIndex","-1"));this.keySel=void 0;this.$title.parentNode.focus()},onSrollInSelect:function(){console.info("onSrollInSelect");if(this.$select.scrollTop===0)this.$select.scrollTop=1;else if(this.$select.scrollTop===this.$select.scrollHeight-this.$select.clientHeight)this.$select.scrollTop=
this.$select.scrollHeight-this.$select.clientHeight-1},toggle:function(){!this.visible&&this.dataSource.length!==0?this.show():this.hide()},show:function(){this.$select.style.display="block";this.visible=true;b.css.addClass(this.$title,"select-open");c.lastShown&&c.lastShown.hide();c.lastShown=this},hide:function(){this.$select.style.display="none";this.visible=false;b.css.removeClass(this.$title,"select-open");c.lastShown=null},hideEntry:function(){b.css.hide(b("subcategory-value"));this.id=-2},
selectDefault:function(){this.$title.innerHTML="-";this.id=-1;b.css.show(b("subcategory-value"))}});c.hideAll=function(){c.lastShown&&c.lastShown.hide()};return c});
