(function(m,k){typeof define==="function"&&define.amd?define(k):m.XSS=k()})(this,function(){function m(a,d,f){if(v.test(d))return"";var h=(a=o[a][d])&&a.regexp,b=a&&a["default"];if(d==="href"||d==="src"){i.lastIndex=0;if(i.test(f))return b||"#";j.lastIndex=0;if(j.test(f))return b||"#";p.lastIndex=0;if(!p.test(f))return b||"#";return h&&(h.lastIndex=0,!h.test(f))?b||"#":f}else if(a||w[d]){q.lastIndex=0;if(q.test(f))return b||"";r.lastIndex=0;if(r.test(f))return b||"";return d==="style"&&(s.lastIndex=
0,s.test(f))?b||"":f}return""}var k=/</g,x=/>/g,t=/<(\/)*([a-zA-Z0-9_:\.\-]+)([^>a-zA-Z0-9_:\.\-]+[^>]*)*>/ig,l=/[^>a-zA-Z0-9_:\.\-]*([a-zA-Z0-9_:\.\-]+)=[\"\']?([^\"\'\s>]*)[\"\']?/ig,v=/[^>a-zA-Z0-9_:\.\-]/ig,i=/\/\*|\*\//mg,j=/^[\s"'`]*((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/ig,q=/\/\*|\*\//mg,r=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/ig,s=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n/ig,p=RegExp("((news|telnet|nttp|file|http|ftp|https)://){1}(([-A-Za-z0-9]+(\\.[-A-Za-z0-9]+)*(\\.[-A-Za-z]{2,5}))|([0-9]{1,3}(\\.[0-9]{1,3}){3}))(:[0-9]*)?(/[-A-Za-z0-9_\\$\\.\\+\\!\\*\\(\\),;:@&=\\?/~\\#\\%]*)*",
"gi"),y=RegExp("(?:[^\\'\\\"]|^|s+)((((news|telnet|nttp|file|http|ftp|https)://)|(www\\.))(([-A-Za-z0-9]+(\\.[-A-Za-z0-9]+)*(\\.[-A-Za-z]{2,5}))|([0-9]{1,3}(\\.[0-9]{1,3}){3}))(:[0-9]*)?(/[-A-Za-z0-9_\\$\\.\\+\\!\\*\\(\\),;:@&=\\?/~\\#\\%]*)*)(?![^<]*</a>)","gi"),z=/^\s|\s$/ig,o={h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},hr:{},span:{},strong:{},b:{},i:{},br:{},p:{},pre:{},code:{},a:{target:{"default":"_blank"},href:true,title:true},img:{src:true,alt:true,title:true,rel:true},div:{},table:{border:true},
tr:{rowspan:true},td:{colspan:true},th:{colspan:true},tbody:{},thead:{},ul:{},li:{},ol:{},dl:{},dt:{},em:{},cite:{},section:{},header:{},footer:{},blockquote:{},audio:{autoplay:true,controls:true,loop:true,preload:true,src:true},video:{autoplay:true,controls:true,loop:true,preload:true,src:true}},w={width:true,height:true,style:true},u=function(a){if(!a)return true;for(var d in a)return false;return true};return{filter:function(a,d){var f={},h=0,b={};t.lastIndex=0;a=a.replace(t,function(a,c,d,g){var e=
d||"";e=e.toLowerCase();_defaultWhiteList=o[e];if(!e||!_defaultWhiteList)return a||"";if(c)return b[e]&&b[e].length?(b[e].pop(),b[e].length||delete b[e],f[h]="</"+d+">","{%DataIndex_"+h++ +"%}"):"</"+d+">";else{c=(g||"").replace(z,"");(c==="/"||!c)&&u(_defaultWhiteList);if(c)if(l.lastIndex=0,l.test(c)){l.lastIndex=0;var i=[];c.replace(l,function(a,b,c){a=b.toLowerCase();c=m(e,a,c);i.push(c?" "+a+'="'+c+'"':"")});c=i.join("")}else c="";if((c==="/"||!c)&&!u(_defaultWhiteList))return a||"";b[e]||(b[e]=
[]);b[e].push(e);f[h]="<"+e+(c?" "+c:"")+">";return"{%DataIndex_"+h++ +"%}"}});d||(a=a.replace(k,"&lt;").replace(x,"&gt;"));var a=a.replace(/\{\%DataIndex_(\d+)\%\}/ig,function(a,c){return f[c]||""}).replace(y,function(a,c){var b="";a+="";a.length==c.length+1&&(b=a[0],a=c);var d="",d=a.indexOf("://")==-1?"http://"+a:a;return b+'<a href="'+d+'" target="_blank">'+a+"</a>"}),n=[],g;for(g in b)if(!(g==="img"||g==="br"||g==="p"||g==="hr")){var i;if(i=b[g].length)for(var j=0;j<i;j++)n.push("</"+g+">")}n.length&&
(a+=n,join(""));return a}}});
