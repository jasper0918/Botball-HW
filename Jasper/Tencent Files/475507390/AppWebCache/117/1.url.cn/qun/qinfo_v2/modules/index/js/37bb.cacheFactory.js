(function(b,d){typeof define==="function"&&define.amd?define(["modules/common/js/util"],d):b.CacheFactory=d(b.Util)})(this,function(b){window._pre_fetch_cache={};window._has_add_drag=true;var d=false,c=0,e,h={OnStartDragMove:function(){try{window.external.StartDragMove()}catch(a){}}},j=function(){window.addEventListener("message",function(a){a=eval("("+a.data+")");switch(a.event){case "get_group_info_done":a.from=="Home"&&g("home",a.groupuin,a.html,a.header)}})},g=function(a,b,c,e){if(d)d=false;else{var i=
"cache_"+a,f=localStorage.getItem(i),f=f&&JSON.parse(f)||{};f[b]={html:c,time:new Date-0,headerHtml:e};try{localStorage.setItem(i,JSON.stringify(f))}catch(h){localStorage.clear(),d=true,g(a,b,c,e)}}},k=function(){var a=window._pre_fetch_cache[window.global_get_group_info];a.state="waiting";a.lastRequestSentTime=new Date-0;b.http.get("/cgi-bin/"+window.global_get_group_info,{gc:c,src:"qinfo_v2",bkn:b.encryptSkey()},function(b){a.requestGotTime=new Date-0;a.state="ok";a.data=b;window.__group_info_fetched=
true;window.postMessage(JSON.stringify({event:"PreFetchData",from:"CacheFactory",cgiName:window.global_get_group_info}),"http://qinfo.clt.qq.com")})};return{init:function(){c=b.hash.get("groupuin");e=b.hash.get("role");window.global_get_group_info=e==4?"qun_info/get_group_info_en":"qun_info/get_group_info_all";window._pre_fetch_cache={};window._pre_fetch_cache[window.global_get_group_info]={};var a=JSON.parse(localStorage.getItem("cache_home")),d=localStorage.getItem("cache_version")||0,g=localStorage.getItem("cache_role")||
-1;if(d!=12||g!=e)localStorage.clear("cache_home"),localStorage.setItem("cache_version",12),localStorage.setItem("cache_role",e);else if(a&&a[c]&&(document.getElementById("container_home").innerHTML=a[c].html,a[c].headerHtml))window._has_add_drag=false,document.getElementById("header").innerHTML=a[c].headerHtml,(a=document.getElementById("drag_area"))&&a.addEventListener("mousedown",function(a){a.button==0&&h.OnStartDragMove()});j();k(c)}}});
